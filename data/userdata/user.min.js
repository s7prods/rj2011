!function(){let t,n;async function a(a){n=await(await fetch("data/userdata/"+t.users[a]["user.profile.location"])).json(),await async function(t,n){let a=document.querySelector("#main nav .login-button");if(!a)return!1;n["profile.avatar"]?a.querySelector("img").src="data/userdata/"+t["user.profile.location"]+"/../"+n["profile.avatar"]:a.querySelector("img").alt=n["user.nickname"];let e=CreatePopupMenu();AppendMenu(e,String,{disabled:!0},n["user.nickname"]),AppendMenu(e,String,{disabled:!0},"UID: "+t["user.id"]),AppendMenu(e,"separator"),"guest"===t["user.name"]?AppendMenu(e,String,{},"登录",(function(){location.hash="#/account/login/"})):(AppendMenu(e,String,{},"个人主页",(function(){location.hash="#/user/me/profile"})),AppendMenu(e,"separator"),AppendMenu(e,String,{},"修改昵称",(function(){location.hash="#/account/edit/nickname"})),AppendMenu(e,String,{},"修改头像",(function(){location.hash="#/account/edit/avatar"})),AppendMenu(e,String,{},"修改签名",(function(){location.hash="#/account/edit/sign"}))),AppendMenu(e,"separator"),AppendMenu(e,String,{},"退出登录",(function(){location.hash="#/account/logout/confirm"})),a.addEventListener("click",(function(){let t=a.getBoundingClientRect();TrackPopupMenu(e,document.documentElement.clientWidth-t.right,t.bottom+5,{closeOnBlur:!0,align:{right:!0}})}))}(t.users[a],n)}globalThis.data_init=async function(){try{t=await(await fetch("data/userdata/users.json")).json(),await async function(){try{let t=rj2011_data.user.current;return await a(t.id)}catch{return await a("c51bac0d-a6fd-41ba-8b74-a30874c7aef8")}}()}catch(t){console.error("[ERROR] 无法加载用户数据",t),showinfo("严重: 无法加载用户数据:\n"+t,"error",1e4)}},globalThis.accountHelper={Handlers:{url:{handle(t,n){if(!t)throw new TypeError;if(t.startsWith("/account/login/"))return n("data/userdata/auth/login.html#"+t);if(t.startsWith("/account/logout/confirm"))return n("data/userdata/auth/logout_confirm.html#"+t);if(t.startsWith("/account/logout/"))return n("data/userdata/auth/logout.html#"+t);throw new Error("请求无效")}}}}}();