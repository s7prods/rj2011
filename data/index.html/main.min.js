dependencies.on("util.js","data_init.js","wm_helper","r-cu-el","custom-progressbar").then((function(){!function(){let t=document.getElementById("main"),e=null,n=new GenshinImpactLoadingProgressClass;{let c=document.createElement("div");c.classList.add("page-loading-progress"),n.moveTo(c),t.append(c)}function a(){let n=document.getElementById("loading_details"),a=document.getElementById("loading_page"),r=new GenshinImpactLoadingProgressClass;function i(t=0){return Promise.prototype.isPrototypeOf(t)?t.then((()=>i())):t?1===t?(r.value=100,setTimeout(i,getRandom(1e3,1500),2)):(r.hide_and_destroy(),void a.remove()):(r.value=r.getHalfGeoValue(),setTimeout(i,getRandom(1e3,2e3),1))}r.setRange(0,100),r.show(),LoadChunk("data/index.html/chunks/01",2,2,(function(t,e){r.value=function(){if(0==t&&0==e)return 5;if(1==t&&0==e)return 10;if(0==t&&1==e)return 20;if(1==t&&1==e)return 25;throw new Error("Cannot understand w and h")}()})).then((function(n){const a=document.createElement("div");a.innerHTML=n,a.classList.add("container"),t.append(a),e=t.querySelector("main"),r.value=30})).then((function(){if(navigator.userAgent.includes("Mozilla/")){const t=document.getElementById("SEO");t&&t.remove()}})).then((function(){t.querySelector("#app_menubar_btn").onclick=function(){t.querySelector("#app_menubar").style.display="flex"},t.querySelector("#app_menubar").addEventListener("click",(function(t){t.target!==this&&(this.style.display="")}),{capture:!0}),r.value=35})).then((async function(){await data_init(),r.value=50;try{await async function(){(rj2011_data.settings||{}).do_not_use_GILP&&addCSS(".GenshinImpactLoadingProgressWrapperClass{display:none!important}"),t.querySelector("#plugins-button-container").addEventListener("click",(function(t){this.classList.toggle("open")}),{capture:!0}),(t.querySelector("#webpage-fullscreen-button")||{}).onclick=function(){t.querySelectorAll("#webpage-fullscreen-button,main").forEach((t=>t.classList.toggle("expanded")))}}()}catch(t){console.error("Failed to initialize:",t)}o({callback:function(){r.value=75,setTimeout(i,300)}})})).catch((t=>function(t){r.destroy(),console.error(t);let e=document.createElement("div");e.style.color="red",e.innerText=String(t),n.prepend(e)}(t)))}setTimeout((function(){if(!location.origin.includes("127.0.0.1"))return;const t=document.createElement("div");t.id="tip-in_developing",t.innerHTML="开发中内容，请以实际上线为准",addCSS("#tip-in_developing {position: fixed;left: 10px;bottom: 10px;border: 1px solid;padding: 5px;background: white;font-size: small;color: grey;pointer-events: none;z-index: 1001;}",t),(document.body||document.documentElement).append(t)})),setTimeout((function(){const t=console.error;console.error=function(){const e=t.apply(console,arguments);let n="";for(let t=0;t<arguments.length;++t)n+=arguments[t]+" ";return showinfo(`错误: ${n}\r\n(查看控制台以获取更多信息)`,"error"),e}}));{const d="rj2011",u=function(){let t="allow-forms allow-popups allow-popups-to-escape-sandbox allow-modals allow-downloads allow-scripts";return t+=" allow-same-origin","allow-forms allow-popups allow-popups-to-escape-sandbox allow-modals allow-downloads allow-scripts allow-same-origin"}();function o({event:t=null,callback:e=null}){let n=function(){let t=location.hash;return t=t.substring(1),function(t=""){if(""===t||"/"===t)return g=location.hash,h["index\ufeff"](t);for(const e in h)if(t.startsWith(e)){let n=h[e](t);return!1===n?(history.replaceState({},"",g),!1):(g=location.hash,n)}return h["default\ufeff"](t)}(decodeURIComponent(t))}();return e&&e(n),n}let p=function(){const t=Object.create({toString:()=>"Sandbox Violation"}),n=Object.create({toString:()=>"Origin Violation"});let a=0;return async function(){if(!e)return!1;const r=e.querySelector("iframe.content");if(!r)return!1;try{if(String(r.sandbox)!==u&&String(r.sandbox)!==sandbox_options_2)throw t;r.contentWindow.postMessage({api:"cors-helper",subapi:"adjust_the_height_of_iframe"},location.origin)}catch(i){console.warn("Unable to set height of iframe.\n",i,String(i));try{if(i===t)throw i;if(i===n)throw i;r.contentWindow.location.origin}catch(t){if(++a>10)return console.error("[FATAL] Access violation for ",a,"\nDocument load is blocked."),void(e.innerHTML='<h1 style="color:red">致命错误</h1><h3>Access violation</h3><div>请尝试重新加载页面</div>');console.error("[Security Error] Unable to access iframe, reloading document.\nError",t,String(t)),o({})}}}}();setInterval(p,1e3),window.addEventListener("resize",(function(){p()})),window.addEventListener("message",(function(t){if(t.origin!==location.origin)return;if(!t.data)return;if("cors-helper"!==t.data.api||"adjust_the_height_of_iframe"!==t.data.subapi)return;if(!e)return!1;const n=e.querySelector("iframe.content");if(!n)return!1;let a=t.data.data.height;n.style.height=a+"px";const o=t.data.data.title+" - "+d;o!==document.title&&(document.title=o)}));const f={scripts:{"data/main/js/cors-helper.js":null,"data/js/dependencies.js":null,"data/js/util.js":null,"data/js/winmenu-helper-custom.min.js":null,"data/main/js/data_init.js":null,"data/main/js/r-custom-elements.min.js":null,"data/main/js/link-navi-helper.js":null,"[statcode]":null},styles:{"data/main/css/general.css":null,"data/main/css/w32ctl.css":null}},h={"/page/":function(t){return r(t=t.substring(6))},"/article/":function(t){return r(t=t.substring(9))},"/index/":function(t){return r("data/main/data/data/index/myindex/")},"/settings/":function(t){return r("data/main/data/fn/settings/app.htm")},"/account/":function(t){try{return accountHelper.Handlers.url.handle(t,r)}catch(t){console.error(t),showinfo("[!] 找不到所需的数据\n[Internel Debug] "+t,"error")}return!1},"/user/":function(t){return showinfo("暂未实现","error",0),!1},"/contribute/":function(t){return(t=t.substring(12)).startsWith("new")?r("data/main/data/fn/contribute/new.html#"+t):t.startsWith("activity-")?r(function(){const e=new URL(location);e.pathname="/";const n=new URL(t,e);return new URL("data/main/data/fn/contribute/"+n.pathname.substring(1)+".html",e).pathname.substring(1)}()):showinfo("请求无效","error")&&!1},"/search/":function(t){return r("data/main/data/fn/search/#"+t)},"/about/":function(t){return r("data/main/data/fn/about/about.html#"+t)},"index\ufeff":function(t){return r("data/main/data/data/index/index.html")},"default\ufeff":function(t){return r("data/main/data/data/index/404.html")}};let g=location.hash;async function r(a="",o="page"){return async function(a){if(!a)throw new TypeError("Invalid paramter");if(a.startsWith("http")||a.startsWith("//"))throw new Error("Security Error");e.innerHTML="",n.value=0,n.show(),(t.querySelector(".page-loading-progress")||{}).hidden=!1;for(let t of m)t&&t.abort("Loading a new page");m=[];for(let t in w){const e=w.get(t);try{URL.revokeObjectURL(e)}catch{}w.delete(t)}let o="fetch-download",r=t.querySelector("[data-id=data-download-details]")||{},i=null,s=0;{r.innerHTML="";const t=document.createElement("div");t.className="loading-progress-text",t.dataset.value=0,t.style.left=0,r.append(t),s=setInterval((()=>{Number(t.dataset.value)<99&&(t.dataset.value-=-1,t.style.left=`calc(${t.dataset.value}% - 2em)`)}),50)}try{i=await new Promise((function(t,e){let n="";{let i=new AbortController;fetch(a,{signal:i.signal,method:"head"}).then((function(s){return n=s.headers.get("Content-Type"),n.includes("text/html")?(o="html-document-load",i.abort(),t()):async function(){let o,i=new AbortController;m.push(i);try{o=await fetch(a,{signal:i.signal})}catch(t){return e(t)}let s=o.body.getReader();const l=+o.headers.get("Content-Length");let c=0,d=[];for(;;){const{done:t,value:e}=await s.read();if(t)break;d.push(e),c+=e.length,r.innerText=document.title=`${Math.floor(c/l*100*1e3)/1e3}% (${c} / ${l})`}r.innerText="",document.title=" - rj2011",m=[];let u=new Blob(d,{type:n});return t(u),u}()})).catch(e)}}))}catch(t){return/abort/i.test(String(t))||(console.error("[ERROR] Error while loading content:",t),r.innerHTML='<div style="color:red"><b>加载失败</b></div><details><summary>错误信息</summary><div data-data></div></details>',r.querySelector("div[data-data]").innerText=String(t)),null}let l,c=document.createElement("iframe");async function d(){"html-document-load"===o&&await async function(t){const e={},n=function(){const n=document.createElement("div");return async function(a,o,r){if(n.innerHTML="","[statcode]"===o)return;let i=f[a][o];if(i&&i.url)i=i.url;else try{const t=await fetch(o);if(!t.ok)throw"HTTP "+t.status+" "+t.statusText;f[a][o]=new Object,f[a][o].blob=await t.blob(),f[a][o].url=URL.createObjectURL(f[a][o].blob),i=f[a][o].url}catch(t){return console.error("Unable to load",o,"because",t),e}const s=document.createElement(r);switch(r){case"link":s.rel="stylesheet",s.href=i;break;case"script":s.src=i,s.async=!1;break;default:s.src=i}(t.contentWindow.document.head||t.contentWindow.document.documentElement).append(s)}}();for(const t in f.scripts)await n("scripts",t,"script");for(const t in f.styles)await n("styles",t,"link");if(!1!==rj2011_data.allowStatistics)try{if(!location.origin.includes("127.0.0.1")&&rj2011_data["acceptedEULA.u"]){if(!f.scripts["[statcode]"]){const t=await fetch("data/main/data/EULA/stat");if(!t.ok)throw t;f.scripts["[statcode]"]=await t.text()}const e=new t.contentWindow.Function(f.scripts["[statcode]"]);await t.contentWindow.setTimeout(e)}}catch(t){console.warn("[Statistics] Failed to insert stat into content page:",t)}return t}(c),setTimeout(p,100),n.value=n.getHalfGeoValue(),setTimeout((()=>{n.value=100,s&&clearInterval(s),r.innerHTML="",c.style.display="",setTimeout((()=>{n.hide()}),200),setTimeout((()=>{(t.querySelector(".page-loading-progress")||{}).hidden=!0}),1e3)}),getRandom(500,1e3))}if("fetch-download"===o&&(l=URL.createObjectURL(i),w.set(c,l)),c.sandbox=u,c.title="Content",c.src="fetch-download"===o?l:a,"fetch-download"===o&&(c.onload=d),c.onerror=function(t){"fetch-download"===o&&(URL.revokeObjectURL(l),l=null),s&&clearInterval(s),r.innerHTML="",console.error("Failed to load content:",t)},c.classList.add("content"),c.style.display="none",e.append(c),"html-document-load"===o){let t=c.contentDocument,e=setInterval((function(){let n=c.contentDocument;t!==n&&(clearInterval(e),d())}),250)}}(a)}let m=[],w=new Map;function i(t){o({event:t})}function s(){setTimeout(a),window.addEventListener("hashchange",i)}window.addEventListener("message",(function(t){if(t.origin===location.origin&&t.data&&"redirect_hash"===t.data.type&&t.data.url){if(t.data.standalone)return window.open(t.data.url,"_blank");if(t.data.blank){const e=(t=>{if("blank"!==t)return"newWindow"===t?`width=${window.innerWidth},height=${window.innerHeight},left=${window.screenLeft},top=${window.screenTop}`:void 0})(t.data.blank),n=new URL(location);return n.hash="#/"+t.data.url,window.open(n.href,"_blank",e)}if(String(t.data.url).startsWith("#"))return location.hash=t.data.url;location.hash="#/"+t.data.url}})),globalThis.pagereload=function(){o({})},"loading"==document.readyState?window.addEventListener("DOMContentLoaded",s,{once:!0}):setTimeout(s)}window.addEventListener("message",(function(t){if(t.origin===location.origin&&t.data&&"cors-helper"===t.data.api&&String(t.data.subapi).startsWith("storageAPI")&&!t.data.callback)switch(t.data.subapi){case"storageAPI.get":{let e=JSON.parse(JSON.stringify(rj2011_data));t.source.postMessage({api:t.data.api,subapi:t.data.subapi,callback:!0,result:e},t.source.origin)}break;case"storageAPI.set":try{rj2011_data=t.data.data,rj2011_data.update,t.source.postMessage({api:t.data.api,subapi:t.data.subapi,callback:!0,id:t.data.id,result:t.data.data},t.source.origin)}catch(e){t.source.postMessage({api:t.data.api,subapi:t.data.subapi,callback:!0,id:t.data.id,error:!0,result:e},t.source.origin)}break;case"storageAPI.setItem":try{rj2011_data[t.data.data.key]=t.data.data.value,rj2011_data.update,t.source.postMessage({api:t.data.api,subapi:t.data.subapi,callback:!0,id:t.data.id,result:t.data.data},t.source.origin)}catch(e){t.source.postMessage({api:t.data.api,subapi:t.data.subapi,callback:!0,id:t.data.id,error:!0,result:e},t.source.origin)}break;default:t.source.postMessage({api:t.data.api,subapi:t.data.subapi,callback:!0,result:new Error("API not found"),error:!0},t.source.origin)}}));const l={showinfo:globalThis.showinfo,requestInput:globalThis.requestInput,reload_content:globalThis.pagereload,"history.go":globalThis.history.go.bind(globalThis.history),requestLogin:globalThis.requestLogin,reLoad:globalThis.location.reload.bind(globalThis.location)};window.addEventListener("message",(function(t){if(t.origin!==location.origin)return;if(!t.data)return;if(!l[t.data.api])return;let e;try{e=l[t.data.api].apply(window,t.data.args||[])}catch(e){return t.source.postMessage({type:"api_callback",result:null,error:!0,why_result_is_null:String(e),callback_id:t.data.id},t.source.origin)}if(Promise.prototype.isPrototypeOf(e))e.then((function(e){t.source.postMessage({type:"api_callback",async:"true",result:e,callback_id:t.data.id},t.source.origin)})).catch((function(e){t.source.postMessage({type:"api_callback",async:!0,error:!0,result:e,callback_id:t.data.id},t.source.origin)})).catch((function(e){console.error("Failed to handle message",t,":",e),t.source.postMessage({type:"api_callback",async:!0,error:!0,error_type:"unknown",result:null,callback_id:t.data.id},t.source.origin)}));else try{t.source.postMessage({type:"api_callback",result:e,callback_id:t.data.id},t.source.origin)}catch(e){t.source&&t.source.postMessage({type:"api_callback",result:null,why_result_is_null:String(e),callback_id:t.data.id},t.source.origin)}})),window.addEventListener("keydown",(function(t){if("P"===t.key.toUpperCase()&&t.ctrlKey)try{return callPrint(),t.preventDefault(),!1}catch(t){console.error("[ERROR] Failed to call print in sub document:",t,"\nCalling native API instead")}})),globalThis.callPrint=function(){const e=t.querySelector("main iframe").contentWindow;return e.setTimeout((async function(){return new Promise((function(t){t(e.print())}))}))}}()}));